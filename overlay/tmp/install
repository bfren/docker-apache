#!/bin/sh

set -euo pipefail
export BF_E=`basename ${0}`


#======================================================================================================================
# Add apache user.
#======================================================================================================================

bf-adduser apache


#======================================================================================================================
# Get Apache Version.
#======================================================================================================================

cd /tmp

VERSION=$(cat APACHE_BUILD)
bf-echo "Apache version ${VERSION}."


#======================================================================================================================
# Install Apache and dependencies.
#======================================================================================================================

bf-echo "Installing Apache v${VERSION}..."
apk add --no-cache \
    ca-certificates \
    apache2=${VERSION} \
    apache2-ctl=${VERSION} \
    apache2-http2=${VERSION} \
    apache2-utils=${VERSION}
mkdir -p /run/httpd
bf-done


#======================================================================================================================
# Cleanup.
#======================================================================================================================

bf-echo "Cleaning up default Apache configuration and files."
rm -rf /var/www/localhost/*


#======================================================================================================================
# Create and link Apache directories.
#======================================================================================================================

bf-echo "Creating Apache directories."

bf-echo "Linking /www to /var/www/localhost/htdocs."
ln -s /www /var/www/localhost/htdocs
